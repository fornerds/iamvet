# 카카오 비즈니스 API 설정 가이드

카카오톡 SNS 회원가입 시 플러스친구 환영 메시지를 자동으로 발송하기 위한 설정 가이드입니다.

## 사전 준비사항

1. **카카오 비즈니스 채널 개설**
   - [카카오 비즈니스 관리자 센터](https://business.kakao.com/)에서 채널 개설
   - 비즈니스 인증 완료

2. **카카오 개발자 콘솔 설정**
   - [카카오 개발자 콘솔](https://developers.kakao.com/) 접속
   - 앱 설정 > 제품 설정 > 카카오 로그인 활성화
   - 동의항목에서 `talk_message` 권한 추가

## 환경 변수 설정

### 필수 환경 변수

다음 환경 변수들을 `.env.production` 또는 GitHub Secrets에 추가하세요:

```bash
# 카카오 OAuth (기존)
KAKAO_CLIENT_ID="your-kakao-client-id"
KAKAO_CLIENT_SECRET="your-kakao-client-secret"

# 카카오 비즈니스 API 활성화 (선택사항)
USE_KAKAO_BUSINESS_API="true"  # 플러스친구 메시지 발송 활성화
```

### GitHub Secrets 추가

GitHub Actions를 사용하는 경우, 다음 Secrets를 추가하세요:

- `USE_KAKAO_BUSINESS_API` (선택사항, 기본값: "false")

## 카카오 로그인 권한 설정

카카오 로그인 시 `talk_message` 권한을 요청하도록 설정되어 있습니다.

### 카카오 개발자 콘솔에서 설정

1. 카카오 개발자 콘솔 접속
2. 내 애플리케이션 > 앱 선택
3. 제품 설정 > 카카오 로그인
4. 동의항목 > 카카오톡 메시지 전송 권한 추가
   - 필수 동의: 선택 (권장)
   - 동의 화면 설명: "회원가입 환영 메시지를 받기 위해 필요합니다"

## 동작 방식

1. **카카오 로그인**
   - 사용자가 카카오로 로그인 시 `talk_message` 권한 요청
   - 카카오 API에서 사용자 정보와 함께 카카오톡 UUID 수신

2. **회원가입 완료**
   - 회원가입이 성공적으로 완료되면
   - 카카오 회원가입인 경우 플러스친구 환영 메시지 자동 발송
   - 메시지 발송 실패해도 회원가입은 정상 완료 (비동기 처리)

3. **메시지 내용**
   ```
   안녕하세요 😊

   수의학 커뮤니티 아이엠벳입니다.

   가입을 환영드리며, 앞으로 채용·강의 소식 등
   유용한 콘텐츠를 카카오톡으로 가장 빠르게 전달해드릴게요!
   ```

## 주의사항

1. **사용자 동의**
   - 카카오톡 메시지 발송을 위해 사용자의 동의가 필요합니다
   - `talk_message` 권한 동의가 필요합니다

2. **플러스친구 추가**
   - 사용자가 아이엠벳 플러스친구를 추가한 상태여야 메시지를 받을 수 있습니다
   - 플러스친구를 추가하지 않은 경우 메시지 발송이 실패할 수 있습니다

3. **API 제한**
   - 카카오 비즈니스 API는 일일 발송량 제한이 있을 수 있습니다
   - 대량 발송 시 카카오 비즈니스 관리자 센터에서 제한 확인 필요

## 문제 해결

### 메시지가 발송되지 않는 경우

1. **환경 변수 확인**
   ```bash
   echo $USE_KAKAO_BUSINESS_API  # "true" 여야 함
   echo $KAKAO_CLIENT_ID
   echo $KAKAO_CLIENT_SECRET
   ```

2. **카카오톡 UUID 확인**
   - 카카오 로그인 콜백에서 `kakaoTalkUuid`가 정상적으로 전달되는지 확인
   - 개발자 도구 콘솔에서 로그 확인

3. **권한 확인**
   - 카카오 개발자 콘솔에서 `talk_message` 권한이 활성화되어 있는지 확인
   - 사용자가 권한 동의를 했는지 확인

4. **플러스친구 추가 확인**
   - 사용자가 아이엠벳 플러스친구를 추가했는지 확인
   - 카카오 비즈니스 관리자 센터에서 친구 목록 확인

### 로그 확인

서버 로그에서 다음 메시지를 확인할 수 있습니다:

- 성공: `카카오 플러스친구 환영 메시지 발송 성공`
- 실패: `카카오 플러스친구 환영 메시지 발송 실패: {에러 메시지}`

## 참고 자료

- [카카오 비즈니스 관리자 센터](https://business.kakao.com/)
- [카카오 개발자 문서 - 카카오톡 메시지](https://developers.kakao.com/docs/latest/ko/kakaotalk-rest-api)
- [카카오 비즈니스 API 가이드](https://developers.kakao.com/docs/latest/ko/business-api/overview)

