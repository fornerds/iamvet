# 자동 모니터링 시스템 가이드

배포 상태를 수동으로 확인하지 않고 자동으로 모니터링할 수 있는 시스템입니다.

## 🎯 해결된 문제

### 이전 방식 (수동 확인)
- ❌ 매번 SSH 접속해서 확인
- ❌ PM2 상태, 로그 등을 직접 확인
- ❌ 문제 발생 시 즉시 알 수 없음

### 새로운 방식 (자동 모니터링)
- ✅ 간단한 명령어로 상태 확인
- ✅ 웹 브라우저에서 실시간 상태 확인
- ✅ 자동 갱신 (30초마다)
- ✅ 문제 발생 시 즉시 확인 가능

## 📋 사용 방법

### 1. 간단한 상태 확인 (터미널)

로컬에서 간단하게 상태를 확인할 수 있습니다:

```bash
./deploy/check-status.sh
```

**출력 예시:**
```
==========================================
🚀 아이엠벳 배포 상태 확인
==========================================

1. 웹사이트 접속 확인
✅ 웹사이트 정상 작동 (상태 코드: 200)
   URL: https://iam-vet.com

2. 서버 상태 확인
✅ 서버 접속 가능
✅ PM2 프로세스 실행 중
✅ 최근 헬스체크: 정상

==========================================
✅ 배포 상태: 정상

모든 서비스가 정상적으로 작동 중입니다.
웹사이트: https://iam-vet.com
==========================================
```

### 2. 웹 브라우저에서 확인 (추천)

**관리자 페이지에서 실시간 상태 확인:**

1. 웹 브라우저에서 접속:
   ```
   https://iam-vet.com/admin/status
   ```

2. 자동으로 표시되는 정보:
   - ✅ 전체 서버 상태
   - 📊 메모리 사용량
   - 🔄 데이터베이스 연결 상태
   - ⏱️ 서버 가동 시간
   - 📈 응답 시간

3. 자동 갱신:
   - 30초마다 자동으로 상태를 갱신합니다
   - 수동으로 "새로고침" 버튼을 눌러도 됩니다

### 3. API를 통한 상태 확인

프로그래밍 방식으로 상태를 확인할 수 있습니다:

```bash
curl https://iam-vet.com/api/health
```

**응답 예시:**
```json
{
  "status": "ok",
  "timestamp": "2025-12-08T00:00:00.000Z",
  "uptime": 86400,
  "environment": "production",
  "version": "1.0.0",
  "checks": {
    "server": "ok",
    "database": "ok",
    "memory": {
      "used": 256,
      "total": 512,
      "unit": "MB"
    },
    "responseTime": 15
  }
}
```

## 🔍 확인 가능한 항목

### 1. 웹사이트 접속
- HTTPS 접속 가능 여부
- HTTP 상태 코드 확인

### 2. 서버 상태
- EC2 인스턴스 접속 가능 여부
- PM2 프로세스 실행 상태
- 최근 헬스체크 결과

### 3. 상세 정보 (웹 대시보드)
- 서버 가동 시간
- 메모리 사용량
- 데이터베이스 연결 상태
- 응답 시간

## 🚨 문제 발생 시

### 상태 확인 스크립트에서 문제 발견

```bash
./deploy/check-status.sh
```

문제가 발견되면 다음을 확인하세요:

1. **GitHub Actions 로그**
   ```
   https://github.com/fornerds/iamvet/actions
   ```

2. **서버 로그 확인**
   ```bash
   ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205 'pm2 logs iamvet --lines 50'
   ```

3. **헬스체크 로그 확인**
   ```bash
   ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205 'tail -20 /home/ubuntu/iamvet/logs/health-check.log'
   ```

### 웹 대시보드에서 문제 발견

웹 대시보드에서 다음을 확인하세요:

1. **상태가 "❌ 오류"인 경우**
   - 서버가 응답하지 않을 수 있습니다
   - PM2 프로세스가 중지되었을 수 있습니다

2. **데이터베이스가 "❌ 오류"인 경우**
   - 데이터베이스 연결 문제일 수 있습니다
   - RDS 인스턴스 상태를 확인하세요

3. **메모리 사용량이 높은 경우**
   - 메모리 누수 가능성
   - 서버 사양 업그레이드 고려

## 🔄 자동 복구 시스템

자동 모니터링과 함께 **자동 복구 시스템**도 작동 중입니다:

- **헬스체크**: 5분마다 자동으로 서버 상태 확인
- **자동 재시작**: 문제 발견 시 PM2 자동 재시작
- **과도한 재시작 방지**: 최소 5분 간격으로 재시작 제한

자세한 내용은 [자동 복구 시스템 가이드](AUTO_RECOVERY_SYSTEM.md)를 참조하세요.

## 📊 모니터링 주기

| 방법 | 주기 | 용도 |
|------|------|------|
| 웹 대시보드 | 30초 자동 갱신 | 실시간 모니터링 |
| 상태 확인 스크립트 | 수동 실행 | 빠른 상태 확인 |
| 헬스체크 (서버 내부) | 5분마다 | 자동 복구 |
| API 엔드포인트 | 요청 시 | 프로그래밍 방식 확인 |

## 💡 팁

### 1. 북마크 추가
웹 대시보드를 북마크에 추가하면 언제든지 빠르게 확인할 수 있습니다:
```
https://iam-vet.com/admin/status
```

### 2. 모바일에서도 확인 가능
웹 대시보드는 모바일에서도 확인할 수 있습니다.

### 3. API 활용
다른 모니터링 도구나 알림 시스템과 연동할 수 있습니다:
```bash
# 상태 확인 후 알림 전송 예시
if ! curl -f https://iam-vet.com/api/health > /dev/null 2>&1; then
  echo "서버 문제 발생!" | mail -s "알림" admin@example.com
fi
```

## 🎯 결론

이제 **수동으로 확인할 필요가 없습니다!**

1. **일상적인 확인**: 웹 브라우저에서 `/admin/status` 접속
2. **빠른 확인**: `./deploy/check-status.sh` 실행
3. **자동 복구**: 서버 내부 헬스체크가 자동으로 문제 해결

문제가 발생하면 자동으로 감지하고 복구를 시도하며, 웹 대시보드에서 실시간으로 상태를 확인할 수 있습니다.

