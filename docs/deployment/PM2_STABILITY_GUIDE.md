# PM2 ì•ˆì •ì  ìš´ì˜ ê°€ì´ë“œ

## ðŸš¨ ë¬¸ì œì 

### í˜„ìž¬ ìƒí™©ì˜ ë¬¸ì œ

1. **PM2ê°€ ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘ë˜ì§€ ì•ŠìŒ**
   - ì„œë²„ ìž¬ë¶€íŒ… ì‹œ PM2 í”„ë¡œì„¸ìŠ¤ê°€ ì‹œìž‘ë˜ì§€ ì•ŠìŒ
   - ìˆ˜ë™ìœ¼ë¡œ `pm2 start` ì‹¤í–‰ í•„ìš”

2. **SSH í‚¤ ê²½ë¡œê°€ ë§¤ë²ˆ ë‹¬ë¼ì§€ëŠ” ê²ƒì²˜ëŸ¼ ë³´ìž„**
   - ì‹¤ì œë¡œëŠ” ê²½ë¡œê°€ ê³ ì •ë˜ì–´ ìžˆì§€ë§Œ ìŠ¤í¬ë¦½íŠ¸ë§ˆë‹¤ ë‹¤ë¥´ê²Œ ì²˜ë¦¬
   - ì¼ê´€ì„± ì—†ëŠ” ê²½ë¡œ ì²˜ë¦¬

3. **PM2 í”„ë¡œì„¸ìŠ¤ë¥¼ ë§¤ë²ˆ ì‹¤í–‰í•´ì•¼ í•¨**
   - ì •ìƒì ì¸ ìš´ì˜ ë°©ì‹ì´ ì•„ë‹˜
   - PM2ëŠ” í•œ ë²ˆ ì„¤ì •í•˜ë©´ ê³„ì† ì‹¤í–‰ë˜ì–´ì•¼ í•¨

4. **í•˜ë£¨ì— í•œ ë²ˆì”© ìž¬ì‹¤í–‰í•˜ëŠ” ê²ƒ**
   - ì •ìƒì ì¸ ìš´ì˜ ë°©ì‹ì´ ì•„ë‹˜
   - PM2ëŠ” ì•ˆì •ì ìœ¼ë¡œ ê³„ì† ì‹¤í–‰ë˜ì–´ì•¼ í•¨

## âœ… í•´ê²° ë°©ì•ˆ

### 1. PM2 ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘ ì„¤ì •

**ë¬¸ì œ**: ì„œë²„ ìž¬ë¶€íŒ… ì‹œ PM2 í”„ë¡œì„¸ìŠ¤ê°€ ì‹œìž‘ë˜ì§€ ì•ŠìŒ

**í•´ê²°**: PM2 startup ì„¤ì •

```bash
# PM2 startup ì„¤ì • (í•œ ë²ˆë§Œ ì‹¤í–‰)
./deploy/setup-pm2-startup.sh
```

**ë˜ëŠ” ìˆ˜ë™ ì„¤ì •:**

```bash
ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205

# NVM í™˜ê²½ ë¡œë“œ
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

# PM2 startup ì„¤ì •
pm2 startup

# PM2 í”„ë¡œì„¸ìŠ¤ ì‹œìž‘ ë° ì €ìž¥
cd /home/ubuntu/iamvet
pm2 start ecosystem.config.js
pm2 save
```

**í™•ì¸ ë°©ë²•:**

```bash
# ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘ í™•ì¸
sudo reboot
# ìž¬ë¶€íŒ… í›„
pm2 list  # iamvet í”„ë¡œì„¸ìŠ¤ê°€ ìžë™ìœ¼ë¡œ ì‹œìž‘ë˜ì–´ì•¼ í•¨
```

### 2. ë°°í¬ ì›Œí¬í”Œë¡œìš°ì— ìžë™ ì„¤ì • í¬í•¨

**ë°°í¬ ì‹œ ìžë™ìœ¼ë¡œ PM2 startup ì„¤ì •:**

`.github/workflows/deploy-aws.yml`ì— ì´ë¯¸ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:

```yaml
# PM2 ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘ ì„¤ì • (í•œ ë²ˆë§Œ ì„¤ì •)
if ! sudo systemctl list-unit-files | grep -q "pm2-ubuntu.service\|pm2-root.service"; then
  pm2 startup | grep -v "PM2" | grep -v "To setup" | sudo bash || true
fi
pm2 save
```

### 3. SSH í‚¤ ê²½ë¡œ ìžë™ ì°¾ê¸°

**ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìžë™ìœ¼ë¡œ SSH í‚¤ ê²½ë¡œ ì°¾ê¸°:**

```bash
# ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ìžë™ ì°¾ê¸°
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

KEY_FILE=""
if [ -f "$SCRIPT_DIR/keys/$KEY_NAME.pem" ]; then
    KEY_FILE="$SCRIPT_DIR/keys/$KEY_NAME.pem"
elif [ -f "$SCRIPT_DIR/$KEY_PATH/$KEY_NAME.pem" ]; then
    KEY_FILE="$SCRIPT_DIR/$KEY_PATH/$KEY_NAME.pem"
fi
```

ì´ì œ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ì—ì„œ SSH í‚¤ ê²½ë¡œë¥¼ ìžë™ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.

### 4. PM2 ì•ˆì •ì  ì‹¤í–‰ ë³´ìž¥

**ecosystem.config.jsê°€ í•­ìƒ ì¡´ìž¬í•˜ë„ë¡ ë³´ìž¥:**

ë°°í¬ ì›Œí¬í”Œë¡œìš°ì—ì„œ í•­ìƒ `ecosystem.config.js`ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

```yaml
# ecosystem.config.js íŒŒì¼ ìƒì„± (í•­ìƒ ìµœì‹ ìœ¼ë¡œ ì—…ë°ì´íŠ¸)
cat > ecosystem.config.js << 'ECOSYSTEMEOF'
# ... ì„¤ì • ë‚´ìš© ...
ECOSYSTEMEOF
```

## ðŸ“‹ ì •ìƒì ì¸ ìš´ì˜ ë°©ì‹

### PM2ëŠ” í•œ ë²ˆ ì„¤ì •í•˜ë©´ ê³„ì† ì‹¤í–‰ë˜ì–´ì•¼ í•¨

**ì •ìƒì ì¸ íë¦„:**

1. **ì´ˆê¸° ì„¤ì • (í•œ ë²ˆë§Œ)**
   ```bash
   pm2 startup  # ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘ ì„¤ì •
   pm2 start ecosystem.config.js
   pm2 save
   ```

2. **ì¼ìƒì ì¸ ìš´ì˜**
   - PM2ê°€ ê³„ì† ì‹¤í–‰ ì¤‘
   - ìž¬ë¶€íŒ… í›„ ìžë™ìœ¼ë¡œ ì‹œìž‘
   - ë¬¸ì œ ë°œìƒ ì‹œì—ë§Œ ìž¬ì‹œìž‘

3. **ë°°í¬ ì‹œ**
   - ì½”ë“œ ì—…ë°ì´íŠ¸
   - `pm2 restart iamvet` (í”„ë¡œì„¸ìŠ¤ ìž¬ì‹œìž‘ë§Œ)
   - `pm2 save` (ìƒíƒœ ì €ìž¥)

### í•˜ë£¨ì— í•œ ë²ˆì”© ìž¬ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ì •ìƒì´ ì•„ë‹˜

**ë¬¸ì œê°€ ìžˆëŠ” ê²½ìš°:**
- âŒ ë§¤ì¼ ìž¬ì‹œìž‘ í•„ìš”
- âŒ ì„œë²„ ìž¬ë¶€íŒ… í›„ ìˆ˜ë™ ì‹œìž‘ í•„ìš”
- âŒ PM2 í”„ë¡œì„¸ìŠ¤ê°€ ìžì£¼ ì£½ìŒ

**ì •ìƒì ì¸ ê²½ìš°:**
- âœ… PM2ê°€ ê³„ì† ì‹¤í–‰ ì¤‘
- âœ… ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘
- âœ… ë¬¸ì œ ë°œìƒ ì‹œì—ë§Œ ìž¬ì‹œìž‘

## ðŸ”§ ë¬¸ì œ í•´ê²°

### PM2ê°€ ìž¬ë¶€íŒ… í›„ ì‹œìž‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°

```bash
# 1. PM2 startup ìž¬ì„¤ì •
./deploy/setup-pm2-startup.sh

# 2. ë˜ëŠ” ìˆ˜ë™ ì„¤ì •
ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
pm2 unstartup  # ê¸°ì¡´ ì„¤ì • ì œê±°
pm2 startup    # ìƒˆ ì„¤ì • ìƒì„±
pm2 save       # í˜„ìž¬ í”„ë¡œì„¸ìŠ¤ ì €ìž¥
```

### PM2 í”„ë¡œì„¸ìŠ¤ê°€ ìžì£¼ ì£½ëŠ” ê²½ìš°

1. **ë©”ëª¨ë¦¬ ë¬¸ì œ í™•ì¸**
   ```bash
   pm2 describe iamvet
   # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
   ```

2. **ë¡œê·¸ í™•ì¸**
   ```bash
   pm2 logs iamvet --lines 100
   ```

3. **ecosystem.config.js í™•ì¸**
   ```bash
   cat /home/ubuntu/iamvet/ecosystem.config.js
   # max_memory_restart ì„¤ì • í™•ì¸
   ```

### SSH í‚¤ ê²½ë¡œ ë¬¸ì œ

**ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ëŠ” ìžë™ìœ¼ë¡œ SSH í‚¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤:**

```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ ìžë™ìœ¼ë¡œ ì°¾ìŒ
./deploy/check-status.sh
./deploy/setup-pm2-startup.sh
./deploy/setup-cloudwatch-monitoring.sh
```

**ìˆ˜ë™ìœ¼ë¡œ í™•ì¸:**

```bash
# SSH í‚¤ ìœ„ì¹˜ í™•ì¸
ls -la deploy/keys/iamvet-key-new.pem
```

## âœ… í™•ì¸ ì‚¬í•­

### PM2ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸

```bash
# 1. PM2 í”„ë¡œì„¸ìŠ¤ í™•ì¸
ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205 'pm2 list'

# 2. PM2 startup ì„œë¹„ìŠ¤ í™•ì¸
ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205 'sudo systemctl status pm2-ubuntu'

# 3. ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘ í…ŒìŠ¤íŠ¸
ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205 'sudo reboot'
# ìž¬ë¶€íŒ… í›„
ssh -i deploy/keys/iamvet-key-new.pem ubuntu@3.38.238.205 'pm2 list'
# iamvet í”„ë¡œì„¸ìŠ¤ê°€ ìžë™ìœ¼ë¡œ ì‹œìž‘ë˜ì–´ì•¼ í•¨
```

## ðŸŽ¯ ê²°ë¡ 

### ì •ìƒì ì¸ ìš´ì˜ ë°©ì‹

1. **PM2 startup ì„¤ì • (í•œ ë²ˆë§Œ)**
   - ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘
   - ë°°í¬ ì›Œí¬í”Œë¡œìš°ì— í¬í•¨ë¨

2. **PM2ëŠ” ê³„ì† ì‹¤í–‰**
   - í•˜ë£¨ì— í•œ ë²ˆì”© ìž¬ì‹œìž‘í•  í•„ìš” ì—†ìŒ
   - ë¬¸ì œ ë°œìƒ ì‹œì—ë§Œ ìž¬ì‹œìž‘

3. **SSH í‚¤ ê²½ë¡œ ìžë™ ì°¾ê¸°**
   - ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìžë™ìœ¼ë¡œ ì°¾ìŒ
   - ìˆ˜ë™ìœ¼ë¡œ ê²½ë¡œ ì§€ì •í•  í•„ìš” ì—†ìŒ

4. **ë°°í¬ ì‹œ ìžë™ ì„¤ì •**
   - ë°°í¬ ì›Œí¬í”Œë¡œìš°ê°€ ìžë™ìœ¼ë¡œ ì„¤ì •
   - ìˆ˜ë™ ìž‘ì—… ë¶ˆí•„ìš”

### ë‹¤ìŒ ë°°í¬ í›„

ë‹¤ìŒ ë°°í¬ê°€ ì™„ë£Œë˜ë©´:
- âœ… PM2 startup ìžë™ ì„¤ì •
- âœ… ìž¬ë¶€íŒ… í›„ ìžë™ ì‹œìž‘
- âœ… SSH í‚¤ ê²½ë¡œ ìžë™ ì°¾ê¸°
- âœ… ì•ˆì •ì ì¸ ìš´ì˜

**ì´ì œ í•˜ë£¨ì— í•œ ë²ˆì”© ìž¬ì‹œìž‘í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤!**

