# 서버 재부팅 안전성 가이드

## 🔒 데이터 안전성

### ✅ DB 데이터는 안전합니다

**중요**: 데이터베이스는 **AWS RDS**에 별도로 운영되므로, EC2 서버 재부팅과 **완전히 무관**합니다.

```
EC2 (웹 서버) ← 재부팅 가능
    ↓
RDS (데이터베이스) ← 재부팅과 무관, 데이터 안전
```

### 데이터 저장 위치

1. **데이터베이스**: AWS RDS (별도 인스턴스)
   - EC2 재부팅과 무관
   - 데이터 영구 저장
   - 자동 백업 설정 가능

2. **파일 저장소**: AWS S3
   - EC2 재부팅과 무관
   - 데이터 영구 저장

3. **애플리케이션 코드**: EC2 서버
   - 재부팅 후 자동 복구 (PM2 설정)
   - 코드는 Git 저장소에 있음

## ⚠️ 재부팅 시 발생하는 문제

### 1. 일시적 서비스 중단

- **기간**: 약 2-3분
- **영향**: 사용자가 웹사이트에 접속 불가
- **복구**: 자동 (PM2 자동 시작 설정)

### 2. 진행 중인 요청 실패

- 재부팅 중 들어온 요청은 실패
- 사용자는 새로고침 필요

### 3. 세션 데이터 손실 (임시)

- 메모리에 저장된 세션 데이터는 초기화
- DB에 저장된 데이터는 안전

## ✅ 재부팅이 안전한 이유

### 1. 데이터베이스 분리

```bash
# 현재 설정 확인
DATABASE_URL=postgresql://...@rds-endpoint.amazonaws.com:5432/...
```

- RDS는 EC2와 별도 인스턴스
- EC2 재부팅이 RDS에 영향 없음

### 2. 파일 저장소 분리

- 이미지, 파일은 S3에 저장
- EC2 재부팅과 무관

### 3. 자동 복구 설정

- PM2가 자동으로 애플리케이션 시작
- Nginx 자동 시작
- 시스템 서비스로 설정됨

## 🔄 재부팅 프로세스

### 1. 재부팅 전

- PM2 프로세스 정상 종료
- Nginx 정상 종료
- 시스템 정상 종료

### 2. 재부팅 중 (2-3분)

- 서비스 중단
- 사용자 접속 불가

### 3. 재부팅 후

- 시스템 자동 시작
- PM2 자동 시작
- Nginx 자동 시작
- 애플리케이션 자동 시작

## 🛡️ 추가 안전 조치

### 1. 재부팅 전 확인

```bash
# DB 연결 확인
psql $DATABASE_URL -c "SELECT 1"

# S3 접근 확인
aws s3 ls s3://iamvet
```

### 2. 재부팅 후 확인

```bash
# 서비스 상태 확인
pm2 status
systemctl status nginx

# 웹사이트 응답 확인
curl -I https://iam-vet.com
```

## 📊 재부팅 vs 다른 방법 비교

| 방법 | 데이터 안전성 | 다운타임 | 복구 시간 |
|------|--------------|----------|-----------|
| **재부팅** | ✅ 안전 | 2-3분 | 자동 |
| **PM2 재시작** | ✅ 안전 | 10-30초 | 즉시 |
| **서버 사양 업그레이드** | ✅ 안전 | 5-10분 | 수동 |

## 🎯 권장 사항

### 즉시 조치 (가장 안전)

1. **PM2만 재시작** (재부팅보다 안전)
   ```bash
   pm2 restart iamvet
   ```
   - 다운타임: 10-30초
   - 데이터: 완전히 안전
   - 위험도: 매우 낮음

2. **메모리 정리 후 재시작**
   ```bash
   # 캐시 정리
   sync
   echo 3 | sudo tee /proc/sys/vm/drop_caches
   
   # PM2 재시작
   pm2 restart iamvet
   ```

### 재부팅이 필요한 경우

- PM2 재시작으로 해결되지 않을 때
- 시스템 레벨 문제가 있을 때
- 메모리 누수가 심각할 때

## ✅ 결론

**DB 데이터는 완전히 안전합니다.**

- RDS는 EC2와 별도 인스턴스
- 재부팅은 EC2만 재시작
- 데이터는 RDS에 영구 저장

**재부팅 시 주의사항:**
- 2-3분 서비스 중단
- 진행 중인 요청 실패 가능
- 자동 복구됨

**더 안전한 방법:**
- PM2만 재시작 (권장)
- 메모리 정리 후 재시작

